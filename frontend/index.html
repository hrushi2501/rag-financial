<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial RAG System</title>
    <link rel="stylesheet" href="css/tailwind.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Financial RAG</span>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" data-view="upload">
                        <i class="fas fa-upload"></i> Upload
                    </button>
                    <button class="nav-btn" data-view="chat">
                        <i class="fas fa-comments"></i> Chat
                    </button>
                    <button class="nav-btn" data-view="documents">
                        <i class="fas fa-folder"></i> Documents
                    </button>
                    <button class="nav-btn" data-view="help">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                </nav>
                <!-- Theme Toggle Switch -->
                <button id="themeToggle" class="theme-toggle" role="switch" aria-label="Toggle dark mode" aria-checked="false">
                    <span class="toggle-track"></span>
                    <span class="toggle-knob">
                        <span class="icon-sun" aria-hidden="true">
                            <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                                <path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zm10.48 14.32l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM12 4V1h0v3h0zm0 19v-3h0v3h0zm8-8h3v0h-3v0zM1 12h3v0H1v0zm15.24-7.16l1.42 1.42 1.79-1.8-1.41-1.41-1.8 1.79zM4.22 18.36l1.8-1.79-1.42-1.42-1.79 1.8 1.41 1.41zM12 6a6 6 0 100 12 6 6 0 000-12z"></path>
                            </svg>
                        </span>
                        <span class="icon-moon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                                <path d="M21.64 13a9 9 0 01-11.31 7.36 9 9 0 008.95-11.2A7 7 0 0012 2a9 9 0 109.64 11z"></path>
                            </svg>
                        </span>
                    </span>
                </button>
                <div class="system-status" title="System health">
                    <span class="status-indicator" id="statusIndicator">
                        <i class="fas fa-circle"></i>
                    </span>
                    <span id="statusText">Checking...</span>
                    <span class="status-help" aria-hidden="true" title="Degraded means external services are slow or partially unavailable. Retries are enabled.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>
        </div>
    </header>

    
    <main class="main-content">
        <div class="container">

            
            <section id="uploadView" class="view active">
                <div class="view-header">
                    <h1><i class="fas fa-upload"></i> Upload Documents</h1>
                    <p>Upload financial documents for semantic search and analysis</p>
                </div>

                <div class="upload-container">
                    <div class="upload-area" id="uploadArea">
                        <input type="file" id="fileInput" accept=".pdf,.txt,.doc,.docx,.xlsx,.xls,.csv" multiple hidden>
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3>Drag & Drop Files Here</h3>
                        <p>or click to browse</p>
                        <p class="file-types">Supported: PDF, TXT, DOC, DOCX, XLSX, XLS, CSV</p>
                    </div>

                    <div class="upload-options">
                        <h3>Upload Options</h3>
                        <div class="option-group">
                            <label>
                                <input type="checkbox" id="preserveFormatting" checked>
                                Preserve Formatting
                            </label>
                            <label>
                                <input type="checkbox" id="extractTables" checked>
                                Extract Tables
                            </label>
                        </div>
                    </div>
                </div>

                <div id="fileList" class="file-list hidden"></div>
                <div id="uploadProgress" class="upload-progress hidden"></div>
                <div id="uploadResults" class="upload-results hidden"></div>
            </section>

            
            <section id="chatView" class="view">
                <div class="gpt-layout">
                    <!-- Sidebar -->
                    <nav class="gpt-sidebar" id="chatSidebar">
                        <div class="gpt-sidebar-header">
                            <span class="gpt-logo"><i class="fas fa-file-invoice-dollar"></i></span>
                            <button id="toggleSidebarBtn" class="btn-icon gpt-sidebar-toggle" title="Hide sidebar">
                                <i class="fas fa-angle-left"></i>
                            </button>
                        </div>
                        <button id="newChatBtn" class="btn btn-primary gpt-new-chat-btn">
                            <i class="fas fa-plus"></i> New Chat
                        </button>
                        <div class="gpt-sidebar-section">
                            <div class="gpt-sidebar-title">Chats</div>
                            <ul id="chatHistoryList" class="gpt-chat-history-list"></ul>
                        </div>
                        <!-- Add more sections here if needed (e.g., projects, docs) -->
                    </nav>
                    <!-- Retoggle button -->
                    <button id="showSidebarBtn" class="btn-icon gpt-show-sidebar-btn" title="Show sidebar" style="display:none;">
                        <i class="fas fa-angle-right"></i>
                    </button>
                    <!-- Context Menu -->
                    <div id="chatContextMenu" class="chat-context-menu">
                        <div class="chat-context-menu-item" data-action="rename">
                            <i class="fas fa-edit"></i> Rename
                        </div>
                        <div class="chat-context-menu-item danger" data-action="delete">
                            <i class="fas fa-trash"></i> Delete
                        </div>
                    </div>
                    <!-- Main Chat Area -->
                    <main class="gpt-main-area" id="chatMainArea">
                        <header class="gpt-main-header">
                            <h1><i class="fas fa-comments"></i> Chat Assistant</h1>
                            <span class="gpt-main-desc">Ask questions about your documents with AI-powered responses</span>
                        </header>
                        <section class="gpt-chat-section">
                            <div class="gpt-chat-messages" id="chatMessages">
                                <div class="chat-message assistant">
                                    <div class="message-avatar">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="message-content">
                                        <p>Hello! I'm your financial document assistant. Ask me anything about your uploaded documents.</p>
                                    </div>
                                </div>
                            </div>
                            <form class="gpt-chat-input-row" onsubmit="return false;">
                                <textarea id="chatInput" placeholder="Ask a question about your documents..." rows="1"></textarea>
                                <button id="chatSendBtn" class="btn btn-primary gpt-send-btn" type="button">
                                    <i class="fas fa-paper-plane"></i> Send
                                </button>
                                <button id="chatClearBtn" class="btn btn-secondary gpt-clear-btn" type="button">
                                    <i class="fas fa-trash"></i> Clear
                                </button>
                            </form>
                            <div class="gpt-chat-options-row">
                                <label>
                                    <input type="checkbox" id="includeContext" checked>
                                    Include Document Context
                                </label>
                                <label>
                                    Context Chunks:
                                    <select id="contextTopK">
                                        <option value="3">3</option>
                                        <option value="5" selected>5</option>
                                        <option value="10">10</option>
                                    </select>
                                </label>
                            </div>
                        </section>
                    </main>
                </div>
            </section>

            
            <section id="documentsView" class="view">
                <div class="view-header">
                    <h1><i class="fas fa-folder"></i> Document Library</h1>
                    <p>Manage your uploaded documents</p>
                    <button id="refreshDocsBtn" class="btn btn-secondary">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>

                <div id="documentsStats" class="stats-grid"></div>
                <div id="documentsList" class="documents-list"></div>
            </section>

            
            <!-- Help View -->
            <section id="helpView" class="view">
                <div class="view-header">
                    <h1><i class="fas fa-question-circle"></i> Help & Guide</h1>
                    <p>Everything you need to know to get started</p>
                </div>

                <div class="help-content">
                    <!-- Getting Started -->
                    <div class="help-section-card">
                        <div class="help-section-icon">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <h2>Getting Started</h2>
                        <div class="help-steps">
                            <div class="help-step">
                                <span class="step-number">1</span>
                                <div class="step-content">
                                    <h3><i class="fas fa-upload"></i> Upload Documents</h3>
                                    <p>Click the <strong>Upload</strong> tab and drag-and-drop your files. Supports PDF, Word, Text, Excel, and CSV (≤10MB each).</p>
                                </div>
                            </div>
                            <div class="help-step">
                                <span class="step-number">2</span>
                                <div class="step-content">
                                    <h3><i class="fas fa-comments"></i> Ask Questions</h3>
                                    <p>Go to <strong>Chat</strong> and ask naturally. The AI searches your documents and provides answers with sources.</p>
                                </div>
                            </div>
                            <div class="help-step">
                                <span class="step-number">3</span>
                                <div class="step-content">
                                    <h3><i class="fas fa-folder-open"></i> Manage Files</h3>
                                    <p>Visit <strong>Documents</strong> to review uploads. Delete items you no longer need.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Supported File Types (moved up) -->
                    <div class="help-section-card">
                        <div class="help-section-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h2>Supported File Types</h2>
                        <div class="help-faq">
                            <div class="faq-item">
                                <h3>PDF Documents</h3>
                                <p>Common for financial reports, statements, and official documents. Fully supported.</p>
                            </div>
                            <div class="faq-item">
                                <h3>Word Documents (.docx, .doc)</h3>
                                <p>Formatted text and tables supported. Ideal for reports and memos.</p>
                            </div>
                            <div class="faq-item">
                                <h3>Text Files (.txt)</h3>
                                <p>Plain text for notes and transcripts.</p>
                            </div>
                            <div class="faq-item">
                                <h3>Excel Sheets (.xlsx, .xls)</h3>
                                <p>Reads sheet data and tables via built-in extractor. Great for tabular finance data.</p>
                            </div>
                            <div class="faq-item">
                                <h3>CSV Files (.csv)</h3>
                                <p>Parses headers and rows as structured text for accurate retrieval.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tips for Success -->
                    <div class="help-section-card">
                        <div class="help-section-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <h2>Tips for Best Results</h2>
                        <ul class="help-tips">
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Be Specific:</strong> Ask "What was Q3 revenue?" instead of "Tell me about revenue"</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>File Size:</strong> Keep documents under 10MB for faster processing</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Use Context:</strong> Enable "Include Document Context" for accurate, source-backed answers</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Organize Chats:</strong> Create new conversations for different topics using "New Chat"</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Adjust Chunks:</strong> Increase to 10 chunks if answers seem incomplete</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Common Questions -->
                    <div class="help-section-card">
                        <div class="help-section-icon">
                            <i class="fas fa-question"></i>
                        </div>
                        <h2>Common Questions</h2>
                        <div class="help-faq">
                            <div class="faq-item">
                                <h3>File won't upload?</h3>
                                <p>Ensure your file is a supported type (PDF, Word, Text, Excel, CSV) and under 10MB. Try a different browser if it persists.</p>
                            </div>
                            <div class="faq-item">
                                <h3>Getting incomplete answers?</h3>
                                <p>Increase "Context Chunks" to 10 in chat settings. Ask more specific questions with details.</p>
                            </div>
                            <div class="faq-item">
                                <h3>System says "Offline"?</h3>
                                <p>Refresh the page and check your internet. If it continues, the server may be restarting.</p>
                            </div>
                            <div class="faq-item">
                                <h3>How to delete old chats?</h3>
                                <p>Right-click on any chat in the sidebar and select "Delete" from the menu.</p>
                            </div>
                            <div class="faq-item">
                                <h3>Can I rename conversations?</h3>
                                <p>Yes! Right-click any chat and choose "Rename" to give it a custom name.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Best Practices -->
                    <div class="help-section-card">
                        <div class="help-section-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <h2>Best Practices</h2>
                        <ul class="help-tips">
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Upload Related Docs:</strong> Group similar documents together for better context</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Clear Names:</strong> Use descriptive file names like "Q3-Financial-Report.pdf"</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Regular Cleanup:</strong> Delete outdated documents to keep results relevant</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Test Questions:</strong> Try simple queries first to understand how the system responds</span>
                            </li>
                        </ul>
                    </div>

                    <!-- System Status (moved to end) -->
                    <div class="help-section-card">
                        <div class="help-section-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h2>System Status Guide</h2>
                        <div class="status-examples">
                            <div class="status-item">
                                <span class="status-badge success">
                                    <i class="fas fa-circle"></i> Online
                                </span>
                                <p><strong>All Good!</strong> All systems are operational.</p>
                            </div>
                            <div class="status-item">
                                <span class="status-badge warning">
                                    <i class="fas fa-circle"></i> Degraded
                                </span>
                                <p><strong>Slower than usual</strong> but still working. Please be patient.</p>
                            </div>
                            <div class="status-item">
                                <span class="status-badge danger">
                                    <i class="fas fa-circle"></i> Offline
                                </span>
                                <p><strong>Can't connect.</strong> Check your internet or refresh the page.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    
    <div id="toastContainer" class="toast-container"></div>

    
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    
    <script src="js/utils.js"></script>
    <script src="js/nlp.js"></script>
    <script src="js/db.js"></script>
    <script src="js/upload.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/main.js"></script>
</body>

</html>
